{{/* 仅当页面包含 guitar 代码块时，才注入 jTab 依赖并渲染 */}}
{{- $hasGuitar := gt (len (findRE "language-guitar" .Content)) 0 -}}
{{- if $hasGuitar -}}
<style>
	/* Slightly shrink rendered tabs to fit better in content flow */
	.jtab svg { transform: scale(0.8); transform-origin: top left; }
	.jtab { display: inline-block; }
</style>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" type="text/javascript" defer></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js" type="text/javascript" defer></script> -->
<!-- <script src="https://jtab.tardate.com/javascripts/jtab.js" type="text/javascript" defer></script> -->
<script src="{{ "js/jquery.js" | relURL }}" defer></script>
<script src="{{ "js/raphael.js" | relURL }}" defer></script>
<script src="{{ "js/jtab.js" | relURL }}" defer></script>
{{- end -}}

{{/* TOC interactions for pages that render a TableOfContents */}}
{{- $tocHTML := .TableOfContents -}}
{{- $hasTOC := gt (len (findRE "<li>" $tocHTML)) 0 -}}
{{- if and .IsPage (or $hasTOC .Params.Toc) -}}
	{{- with resources.Get "js/toc.js" -}}
		{{- if hugo.IsDevelopment -}}
			<script src="{{ .RelPermalink }}" type="module" defer></script>
		{{- else -}}
			{{- with . | minify | fingerprint -}}
				<script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" type="module" defer></script>
			{{- end -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

{{/* Code Block Copy Feature */}}
{{- if .IsPage -}}
	{{- with resources.Get "js/copy-code.js" -}}
		{{- if hugo.IsDevelopment -}}
			<script src="{{ .RelPermalink }}" defer></script>
		{{- else -}}
			{{- with . | minify | fingerprint -}}
				<script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" defer></script>
			{{- end -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

{{/* KaTeX JS & Auto-render (Cloudflare CDN) */}}
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js" crossorigin="anonymous" referrerpolicy="no-referrer" onload="renderMathInElement(document.body, {
  delimiters: [
    {left: '$$', right: '$$', display: true},
    {left: '$', right: '$', display: false},
    {left: '\\(', right: '\\)', display: false},
    {left: '\\[', right: '\\]', display: true}
  ],
  throwOnError : false
});"></script>

{{/* Block-level Latex Block Rendering Support */}}
{{- if .IsPage -}}
	{{- with resources.Get "js/katex-block.js" -}}
		{{- if hugo.IsDevelopment -}}
			<script src="{{ .RelPermalink }}" defer></script>
		{{- else -}}
			{{- with . | minify | fingerprint -}}
				<script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" defer></script>
			{{- end -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

