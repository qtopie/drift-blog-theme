<div class="copyright">
  <small>
    Made with <span style="color: #e25555;">&hearts;</span> in Guangzhou by
    ©<a href="{{ .Site.Params.Author.url }}">{{ .Site.Params.Author.name }}</a> {{ .Site.Lastmod.Format "2006" }}
  </small>
  {{ with .Site.Copyright }}
  <small>{{.| safeHTML}}</small>
  {{ end }}
</div>

<!-- lazy init scripts -->
<div>
    <script type="module" src="/react/base.bundle.js"></script>
    {{/* 仅当页面包含 guitar 代码块时，才注入 jTab 依赖并渲染 */}}
    {{- $hasGuitar := gt (len (findRE "language-guitar" .Content)) 0 -}}
    {{- if $hasGuitar -}}
    {{- with resources.Get "js/guitar.js" }}
    {{- $opts := dict
    "minify" (not hugo.IsDevelopment)
    "sourceMap" (cond hugo.IsDevelopment "external" "")
    "targetPath" "js/guitar.js"
    }}
    {{- with . | js.Build $opts }}
    {{- if hugo.IsDevelopment }}
    <script src="{{ .RelPermalink }}" defer></script>
    {{- else }}
    {{- with . | fingerprint }}
    <script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" defer></script>
    {{- end }}
    {{- end }}
    {{- end }}
    {{- end }}
    {{- end }}

    {{/* Mermaid fallback: SSR pages without React still get diagrams */}}
    {{- if .Page.Store.Get "hasMermaid" -}}
    <script type="module">
      (async ()=>{
        try {
          const mod = await import('https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.mjs');
          const mermaid = mod.default || mod;
          const prefersDark = document.body.classList.contains('dark') || window.matchMedia('(prefers-color-scheme: dark)').matches;
          mermaid.initialize({ startOnLoad: false, theme: prefersDark ? 'dark' : 'default' });
          mermaid.init && mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        } catch (e) { console.error('mermaid load error', e); }
      })();
    </script>
    {{- end -}}

</div>